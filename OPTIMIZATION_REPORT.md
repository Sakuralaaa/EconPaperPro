# EconPaper Pro é¡¹ç›®ä¼˜åŒ–æŠ¥å‘Š

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

åŸºäºé¡¹ç›®è¯„ä¼°æŠ¥å‘Šï¼Œæœ¬æ¬¡å¯¹ EconPaper Pro é¡¹ç›®è¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ï¼Œé‡ç‚¹æ”¹è¿›äº†ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡ä¸å®Œæˆæƒ…å†µ

| ä¼˜åŒ–é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ·»åŠ æ—¥å¿—ç³»ç»Ÿ | âœ… å®Œæˆ | åˆ›å»ºå®Œæ•´çš„ loguru æ—¥å¿—æ¨¡å— |
| æ·»åŠ è‡ªå®šä¹‰å¼‚å¸¸ç±» | âœ… å®Œæˆ | å»ºç«‹å¼‚å¸¸å±‚çº§ä½“ç³» |
| æ”¹è¿›é”™è¯¯å¤„ç†æœºåˆ¶ | âœ… å®Œæˆ | LLM æ¨¡å—å¼‚å¸¸å¤„ç†ä¼˜åŒ– |
| åˆ›å»ºå•å…ƒæµ‹è¯•æ¡†æ¶ | âœ… å®Œæˆ | pytest é…ç½®ä¸ fixtures |
| æ·»åŠ æ ¸å¿ƒæ¨¡å—æµ‹è¯• | âœ… å®Œæˆ | å¼‚å¸¸å’Œ LLM æ¨¡å—æµ‹è¯• |
| ä¸°å¯ŒçŸ¥è¯†åº“èŒƒä¾‹æ•°æ® | âœ… å®Œæˆ | æ–°å¢ 11 ä¸ªé«˜è´¨é‡èŒƒä¾‹ |
| ä¼˜åŒ–UIäº¤äº’ä½“éªŒ | âœ… å®Œæˆ | æ·»åŠ è¿›åº¦æŒ‡ç¤ºå™¨ç»„ä»¶ |

---

## ğŸ“ æ–°å¢/ä¿®æ”¹æ–‡ä»¶æ¸…å•

### 1. æ ¸å¿ƒæ¨¡å— (`core/`)

#### `core/logger.py` (æ–°å¢)
å®Œæ•´çš„æ—¥å¿—ç®¡ç†æ¨¡å—ï¼ŒåŸºäº loguru å®ç°ï¼š
- å¤šçº§åˆ«æ—¥å¿—è®°å½• (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- è‡ªåŠ¨æ—¥å¿—è½®è½¬ (æŒ‰å¤§å° 10MB)
- æ—¥å¿—ä¿ç•™ç­–ç•¥ (7å¤©)
- åˆ†ç¦»çš„é”™è¯¯æ—¥å¿—å’Œ API æ—¥å¿—
- å¼‚æ­¥å†™å…¥æé«˜æ€§èƒ½
- ä¾¿æ·çš„æ—¥å¿—è®°å½•å‡½æ•°

```python
# ä½¿ç”¨ç¤ºä¾‹
from core.logger import get_logger, log_api_call

logger = get_logger("my_module")
logger.info("å¤„ç†å¼€å§‹")
log_api_call(action="chat", model="gpt-4", tokens_used=100)
```

#### `core/exceptions.py` (æ–°å¢)
å®Œæ•´çš„å¼‚å¸¸å±‚çº§ä½“ç³»ï¼ŒåŒ…æ‹¬ï¼š

**é…ç½®å¼‚å¸¸**
- `ConfigurationError` - é…ç½®é”™è¯¯åŸºç±»
- `MissingAPIKeyError` - API å¯†é’¥ç¼ºå¤±

**LLM å¼‚å¸¸**
- `LLMError` - LLM é”™è¯¯åŸºç±»
- `LLMConnectionError` - è¿æ¥é”™è¯¯
- `LLMRateLimitError` - é€Ÿç‡é™åˆ¶
- `LLMAuthenticationError` - è®¤è¯å¤±è´¥
- `LLMResponseError` - å“åº”é”™è¯¯
- `LLMTokenLimitError` - Token è¶…é™

**è§£æå¼‚å¸¸**
- `ParserError` - è§£æé”™è¯¯åŸºç±»
- `UnsupportedFileTypeError` - ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹
- `EmptyContentError` - å†…å®¹ä¸ºç©º
- `ContentTooShortError` - å†…å®¹è¿‡çŸ­
- `PDFParseError` / `DocxParseError` - æ–‡æ¡£è§£æé”™è¯¯

**å¤„ç†æµç¨‹å¼‚å¸¸**
- `DiagnosisError` - è¯Šæ–­é”™è¯¯
- `OptimizationError` - ä¼˜åŒ–é”™è¯¯
- `DedupError` / `DeAIError` - é™é‡/é™AIé”™è¯¯

**è¾…åŠ©å‡½æ•°**
- `format_error_message()` - æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯
- `is_retriable_error()` - åˆ¤æ–­å¯é‡è¯•é”™è¯¯
- `get_user_friendly_message()` - è·å–ç”¨æˆ·å‹å¥½æ¶ˆæ¯

#### `core/llm.py` (ä¿®æ”¹)
é›†æˆæ—¥å¿—å’Œå¼‚å¸¸å¤„ç†ï¼š
- æ·»åŠ æ—¥å¿—è®°å½•ï¼ˆè¯·æ±‚å¼€å§‹ã€å®Œæˆã€é”™è¯¯ï¼‰
- ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸æ›¿ä»£é€šç”¨ RuntimeError
- è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å¤„ç†
- API è°ƒç”¨æ€§èƒ½è®°å½•

### 2. æµ‹è¯•æ¡†æ¶ (`tests/`)

#### `tests/__init__.py` (æ–°å¢)
æµ‹è¯•åŒ…åˆå§‹åŒ–

#### `tests/conftest.py` (æ–°å¢)
pytest é…ç½®å’Œå…±äº« fixturesï¼š
- `project_root_path` - é¡¹ç›®æ ¹ç›®å½•
- `sample_paper_content` - ç¤ºä¾‹è®ºæ–‡å†…å®¹
- `sample_short_content` - çŸ­å†…å®¹æµ‹è¯•
- `mock_llm_response` - æ¨¡æ‹Ÿ LLM å“åº”
- `mock_env_settings` - æµ‹è¯•ç¯å¢ƒå˜é‡
- `MockOpenAIClient` - OpenAI å®¢æˆ·ç«¯ Mock

#### `tests/test_exceptions.py` (æ–°å¢)
å¼‚å¸¸æ¨¡å—æµ‹è¯•ï¼Œè¦†ç›–ï¼š
- åŸºç¡€å¼‚å¸¸ç±»æµ‹è¯•
- é…ç½®å¼‚å¸¸æµ‹è¯•
- LLM å¼‚å¸¸æµ‹è¯•
- è§£æå¼‚å¸¸æµ‹è¯•
- å¤„ç†æµç¨‹å¼‚å¸¸æµ‹è¯•
- è¾…åŠ©å‡½æ•°æµ‹è¯•
- ç»§æ‰¿å…³ç³»éªŒè¯

#### `tests/test_llm.py` (æ–°å¢)
LLM å®¢æˆ·ç«¯æµ‹è¯•ï¼Œè¦†ç›–ï¼š
- åˆå§‹åŒ–æµ‹è¯•ï¼ˆæœ‰æ•ˆ/æ— æ•ˆé…ç½®ï¼‰
- èŠå¤©åŠŸèƒ½æµ‹è¯•
- ç®€åŒ–è°ƒç”¨æ¥å£æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•
- å•ä¾‹è·å–æµ‹è¯•

### 3. çŸ¥è¯†åº“æ•°æ® (`data/exemplars/`)

#### `data/exemplars/additional_exemplars.json` (æ–°å¢)
æ–°å¢ 11 ä¸ªé«˜è´¨é‡ç»æµç®¡ç†ç±»è®ºæ–‡èŒƒä¾‹ï¼š

| ID | åˆ†ç±» | æ¥æº | æ ‡é¢˜ |
|----|------|------|------|
| abs_001 | æ‘˜è¦ | ç»æµç ”ç©¶ | æ•°å­—åŒ–è½¬å‹ä¸ä¼ä¸šåŠ³åŠ¨æ”¶å…¥ä»½é¢ |
| abs_002 | æ‘˜è¦ | ç®¡ç†ä¸–ç•Œ | ç¢³å¸‚åœºæœºåˆ¶ä¸ç»¿è‰²æŠ€æœ¯åˆ›æ–° |
| abs_003 | æ‘˜è¦ | é‡‘èç ”ç©¶ | é‡‘èç§‘æŠ€ä¸é“¶è¡Œé£é™©æ‰¿æ‹… |
| title_001 | æ ‡é¢˜ | - | è®ºæ–‡æ ‡é¢˜å†™ä½œèŒƒä¾‹é›† |
| title_002 | æ ‡é¢˜ | - | æ ‡é¢˜ç»“æ„åˆ†æ |
| intro_003 | å¼•è¨€ | ä¸­å›½å·¥ä¸šç»æµ | äººå·¥æ™ºèƒ½åº”ç”¨ä¸ä¼ä¸šå°±ä¸šç»“æ„ |
| lit_002 | æ–‡çŒ®ç»¼è¿° | ç®¡ç†ä¸–ç•Œ | ESGæŠ•èµ„ç ”ç©¶è¿›å±• |
| hypo_002 | ç ”ç©¶å‡è®¾ | ç»æµç ”ç©¶ | æ•°å­—æ™®æƒ é‡‘èä¸ä¹¡æ‘æŒ¯å…´ |
| method_002 | ç ”ç©¶æ–¹æ³• | ç»æµç ”ç©¶ | åˆæˆæ§åˆ¶æ³•åœ¨æ”¿ç­–è¯„ä¼°ä¸­çš„åº”ç”¨ |
| emp_002 | å®è¯åˆ†æ | é‡‘èç ”ç©¶ | è‚¡æƒæ¿€åŠ±ä¸ä¼ä¸šåˆ›æ–° |
| conc_002 | ç»“è®º | ç»æµç ”ç©¶ | æ•°æ®è¦ç´ å¸‚åœºåŒ–ä¸ä¼ä¸šæ•°å­—åŒ–è½¬å‹ |

### 4. UI ç»„ä»¶ (`ui/`)

#### `ui/components.py` (ä¿®æ”¹)
æ–°å¢è¿›åº¦æŒ‡ç¤ºå’ŒçŠ¶æ€å±•ç¤ºç»„ä»¶ï¼š

**`create_step_progress()`**
æ­¥éª¤è¿›åº¦å±•ç¤ºï¼Œæ”¯æŒï¼š
- å·²å®Œæˆ/è¿›è¡Œä¸­/å¾…å¤„ç†çŠ¶æ€
- è¿æ¥çº¿åŠ¨ç”»
- è„‰å†²åŠ¨ç”»æ•ˆæœ

**`create_processing_timeline()`**
å¤„ç†æ—¶é—´çº¿ï¼Œæ˜¾ç¤ºï¼š
- æ—¶é—´æˆ³
- äº‹ä»¶æè¿°
- çŠ¶æ€å›¾æ ‡

**`create_loading_spinner()`**
åŠ è½½åŠ¨ç”»ï¼š
- æ—‹è½¬åŠ¨ç”»
- ä¸»å‰¯æ¶ˆæ¯

**`create_task_summary()`**
ä»»åŠ¡å®Œæˆæ‘˜è¦ï¼š
- ç»Ÿè®¡æ•°æ®å±•ç¤º
- è€—æ—¶æ ¼å¼åŒ–

**`create_error_display()`**
é”™è¯¯å±•ç¤ºï¼š
- é”™è¯¯æ¶ˆæ¯å’Œä»£ç 
- å»ºè®®æ“ä½œåˆ—è¡¨

### 5. ä¾èµ–é…ç½® (`requirements.txt`)

æ–°å¢æµ‹è¯•æ¡†æ¶ä¾èµ–ï¼š
```
pytest>=7.4.0
pytest-cov>=4.1.0
pytest-asyncio>=0.21.0
```

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd econpaper-main

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_exceptions.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=core --cov-report=html
```

### ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿ

```python
from core.logger import get_logger, log_api_call, log_user_action

# è·å–æ¨¡å—æ—¥å¿—å™¨
logger = get_logger("my_module")

# è®°å½•ä¸åŒçº§åˆ«æ—¥å¿—
logger.debug("è°ƒè¯•ä¿¡æ¯")
logger.info("ä¸€èˆ¬ä¿¡æ¯")
logger.warning("è­¦å‘Šä¿¡æ¯")
logger.error("é”™è¯¯ä¿¡æ¯")

# è®°å½• API è°ƒç”¨
log_api_call(
    action="chat",
    model="deepseek-chat",
    tokens_used=500,
    latency_ms=1234.5
)

# è®°å½•ç”¨æˆ·æ“ä½œ
log_user_action("ä¸Šä¼ æ–‡ä»¶", details="è®ºæ–‡.pdf", content_length=5000)
```

### ä½¿ç”¨å¼‚å¸¸ç±»

```python
from core.exceptions import (
    LLMConnectionError,
    LLMRateLimitError,
    is_retriable_error,
    get_user_friendly_message
)

try:
    # æŸäº›æ“ä½œ
    pass
except LLMRateLimitError as e:
    if is_retriable_error(e):
        # å¯ä»¥é‡è¯•
        time.sleep(e.retry_after or 60)
    else:
        # æ˜¾ç¤ºå‹å¥½æ¶ˆæ¯
        print(get_user_friendly_message(e))
```

### ä½¿ç”¨ UI ç»„ä»¶

```python
from ui.components import (
    create_step_progress,
    create_loading_spinner,
    create_task_summary,
    create_error_display
)

# æ­¥éª¤è¿›åº¦
steps = [
    {"name": "ä¸Šä¼ æ–‡ä»¶", "desc": "è§£æè®ºæ–‡å†…å®¹"},
    {"name": "æ™ºèƒ½è¯Šæ–­", "desc": "åˆ†æè®ºæ–‡è´¨é‡"},
    {"name": "ç”Ÿæˆå»ºè®®", "desc": "æä¾›ä¼˜åŒ–æ–¹æ¡ˆ"},
]
progress_html = create_step_progress(steps, current_step=1)

# åŠ è½½åŠ¨ç”»
loading_html = create_loading_spinner("æ­£åœ¨åˆ†æè®ºæ–‡...", "é¢„è®¡éœ€è¦30ç§’")

# ä»»åŠ¡æ‘˜è¦
summary_html = create_task_summary(
    title="è¯Šæ–­å®Œæˆ",
    stats={"ç»¼åˆè¯„åˆ†": "85åˆ†", "ä¼˜åŒ–å»ºè®®": "12æ¡"},
    duration_seconds=45.6
)
```

---

## ğŸ“ˆ ä¼˜åŒ–å‰åå¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| æ—¥å¿—ç³»ç»Ÿ | âŒ æ—  | âœ… å®Œæ•´ | æ–°å¢ |
| å¼‚å¸¸å¤„ç† | é€šç”¨ Exception | 20+ è‡ªå®šä¹‰å¼‚å¸¸ | ç²¾ç»†åŒ– |
| æµ‹è¯•è¦†ç›– | æ— æµ‹è¯• | æ ¸å¿ƒæ¨¡å—æµ‹è¯• | æ–°å¢ |
| çŸ¥è¯†åº“èŒƒä¾‹ | 7 ä¸ª | 18 ä¸ª | +157% |
| UI ç»„ä»¶ | 6 ä¸ª | 11 ä¸ª | +83% |
| ä»£ç å¯ç»´æŠ¤æ€§ | ä¸­ç­‰ | è‰¯å¥½ | æå‡ |

---

## ğŸš€ åç»­å»ºè®®

1. **ç»§ç»­å®Œå–„æµ‹è¯•**ï¼šä¸º agentsã€enginesã€parsers æ¨¡å—æ·»åŠ å•å…ƒæµ‹è¯•
2. **æ·»åŠ é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•å®Œæ•´çš„è®ºæ–‡å¤„ç†æµç¨‹
3. **æ€§èƒ½ç›‘æ§**ï¼šåŸºäºæ—¥å¿—ç³»ç»Ÿæ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†
4. **çŸ¥è¯†åº“æ‰©å……**ï¼šæŒç»­æ”¶é›†å’Œæ·»åŠ é¡¶åˆŠè®ºæ–‡èŒƒä¾‹
5. **ç”¨æˆ·åé¦ˆæ”¶é›†**ï¼šè®°å½•ç”¨æˆ·æ“ä½œä¹ æƒ¯ï¼ŒæŒç»­ä¼˜åŒ– UI

---

## ğŸ“ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–å·¥ä½œæ˜¾è‘—æå‡äº† EconPaper Pro é¡¹ç›®çš„ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ï¼š

- å»ºç«‹äº†å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºé—®é¢˜æ’æŸ¥å’Œæ€§èƒ½åˆ†æ
- æ„å»ºäº†ç²¾ç»†åŒ–çš„å¼‚å¸¸å¤„ç†ä½“ç³»ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- æ­å»ºäº†æµ‹è¯•æ¡†æ¶åŸºç¡€ï¼Œä¸ºæŒç»­é›†æˆé“ºå¹³é“è·¯
- ä¸°å¯Œäº†çŸ¥è¯†åº“å†…å®¹ï¼Œå¢å¼ºäº†èŒƒä¾‹æ£€ç´¢èƒ½åŠ›
- ä¼˜åŒ–äº† UI äº¤äº’ä½“éªŒï¼Œæä¾›æ›´å¥½çš„è¿›åº¦åé¦ˆ

é¡¹ç›®æ•´ä½“è´¨é‡ä»è¯„ä¼°çš„ **8.7/10** é¢„æœŸå¯æå‡è‡³ **9.0/10** ä»¥ä¸Šã€‚
